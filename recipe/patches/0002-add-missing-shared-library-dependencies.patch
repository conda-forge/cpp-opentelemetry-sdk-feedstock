From 7333b54233024442aa0cf36b0b9dc0400ccb7a31 Mon Sep 17 00:00:00 2001
From: Will Jones <willjones127@gmail.com>
Date: Tue, 18 Apr 2023 11:52:23 -0700
Subject: [PATCH 2/4] add missing shared library dependencies

Co-Authored-By: H. Vetinari <h.vetinari@gmx.com>
---
 cmake/opentelemetry-proto.cmake         |  3 ++-
 exporters/ostream/CMakeLists.txt        |  2 +-
 exporters/otlp/CMakeLists.txt           | 11 +++++++----
 ext/src/http/client/curl/CMakeLists.txt |  4 ++--
 4 files changed, 12 insertions(+), 8 deletions(-)

diff --git a/cmake/opentelemetry-proto.cmake b/cmake/opentelemetry-proto.cmake
index e228504d..e869cb11 100644
--- a/cmake/opentelemetry-proto.cmake
+++ b/cmake/opentelemetry-proto.cmake
@@ -255,7 +255,8 @@ if(WITH_OTLP_GRPC)
     ${LOGS_SERVICE_GRPC_PB_CPP_FILE} ${METRICS_SERVICE_GRPC_PB_CPP_FILE})
 
   list(APPEND OPENTELEMETRY_PROTO_TARGETS opentelemetry_proto_grpc)
-  target_link_libraries(opentelemetry_proto_grpc PUBLIC opentelemetry_proto)
+  target_link_libraries(opentelemetry_proto_grpc PUBLIC opentelemetry_proto
+                        PRIVATE gRPC::grpc++)
 
   set_target_properties(opentelemetry_proto_grpc PROPERTIES EXPORT_NAME
                                                             proto_grpc)
diff --git a/exporters/ostream/CMakeLists.txt b/exporters/ostream/CMakeLists.txt
index af24e9f1..3d018944 100644
--- a/exporters/ostream/CMakeLists.txt
+++ b/exporters/ostream/CMakeLists.txt
@@ -49,7 +49,7 @@ target_include_directories(
   opentelemetry_exporter_ostream_metrics
   PUBLIC "$<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIR}/include>")
 target_link_libraries(opentelemetry_exporter_ostream_metrics
-                      PUBLIC opentelemetry_metrics)
+                      PUBLIC opentelemetry_metrics opentelemetry_resources)
 
 if(OPENTELEMETRY_INSTALL)
   install(
diff --git a/exporters/otlp/CMakeLists.txt b/exporters/otlp/CMakeLists.txt
index e05b0e24..58c09f89 100644
--- a/exporters/otlp/CMakeLists.txt
+++ b/exporters/otlp/CMakeLists.txt
@@ -68,7 +68,8 @@ if(WITH_OTLP_GRPC)
   target_link_libraries(
     opentelemetry_exporter_otlp_grpc
     PUBLIC opentelemetry_otlp_recordable
-           opentelemetry_exporter_otlp_grpc_client)
+           opentelemetry_exporter_otlp_grpc_client
+    PRIVATE gRPC::grpc++)
 
   list(APPEND OPENTELEMETRY_OTLP_TARGETS opentelemetry_exporter_otlp_grpc)
 
@@ -84,7 +85,8 @@ if(WITH_OTLP_GRPC)
   target_link_libraries(
     opentelemetry_exporter_otlp_grpc_log
     PUBLIC opentelemetry_otlp_recordable
-           opentelemetry_exporter_otlp_grpc_client)
+           opentelemetry_exporter_otlp_grpc_client
+    PRIVATE gRPC::grpc++)
 
   list(APPEND OPENTELEMETRY_OTLP_TARGETS opentelemetry_exporter_otlp_grpc_log)
 
@@ -99,7 +101,8 @@ if(WITH_OTLP_GRPC)
   target_link_libraries(
     opentelemetry_exporter_otlp_grpc_metrics
     PUBLIC opentelemetry_otlp_recordable
-           opentelemetry_exporter_otlp_grpc_client)
+           opentelemetry_exporter_otlp_grpc_client
+    PRIVATE gRPC::grpc++)
 
   list(APPEND OPENTELEMETRY_OTLP_TARGETS
        opentelemetry_exporter_otlp_grpc_metrics)
@@ -113,7 +116,7 @@ if(WITH_OTLP_HTTP)
 
   target_link_libraries(
     opentelemetry_exporter_otlp_http_client
-    PUBLIC opentelemetry_sdk opentelemetry_ext
+    PUBLIC opentelemetry_sdk opentelemetry_ext opentelemetry_common
     PRIVATE opentelemetry_proto opentelemetry_http_client_curl
             nlohmann_json::nlohmann_json)
   if(nlohmann_json_clone)
diff --git a/ext/src/http/client/curl/CMakeLists.txt b/ext/src/http/client/curl/CMakeLists.txt
index 7e2507bd..1236808f 100644
--- a/ext/src/http/client/curl/CMakeLists.txt
+++ b/ext/src/http/client/curl/CMakeLists.txt
@@ -14,14 +14,14 @@ if(TARGET CURL::libcurl)
   target_link_libraries(
     opentelemetry_http_client_curl
     PUBLIC opentelemetry_ext
-    PRIVATE CURL::libcurl)
+    PRIVATE CURL::libcurl opentelemetry_common)
 else()
   target_include_directories(opentelemetry_http_client_curl
                              INTERFACE "${CURL_INCLUDE_DIRS}")
   target_link_libraries(
     opentelemetry_http_client_curl
     PUBLIC opentelemetry_ext
-    PRIVATE ${CURL_LIBRARIES})
+    PRIVATE ${CURL_LIBRARIES} opentelemetry_common)
 endif()
 
 if(OPENTELEMETRY_INSTALL)
